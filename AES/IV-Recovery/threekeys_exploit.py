'''
IV Recovery
https://pequalsnp-team.github.io/cheatsheet/crypto-101#predictable-iv-attack
https://www.tildeho.me/ritsec-ctf-writeup-recover-aes-cbc-iv/
https://robertheaton.com/2013/07/29/padding-oracle-attack/
'''

from pwn import *
context(log_level='DEBUG')

def xor(s1, s2):
    return ''.join(chr(ord(c1) ^ ord(c2)) for c1, c2 in zip(s1, s2))

flag = ''

for i in range(1, 4):
    p = remote('chal1.swampctf.com', 1441)
    p.recvuntil('<= ')
    p.sendline(str(i)) #key
    p.recvuntil('<= ')
    p.sendline('1') #encrypt
    p.recvuntil('<= ')
    p.sendline('414141414141414142424242424242424343434343')
    c = p.recvline()
    info(c)
    p.recvuntil('<= ')
    p.sendline('2') #decrypt
    p.recvuntil('<= ')
    p.sendline(c[:32] + '00'*16 + c[:32])
    d = p.recvline().strip()
    info(d)
    ret = xor(d[:32].decode('hex'), d[64:].decode('hex'))
    info(ret)
    flag += ret
    p.close()

success(flag)

# flag{w0w_wh4t_l4zy_k3yz_much_w34k_crypt0_f41ls!}
